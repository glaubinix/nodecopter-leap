// Generated by CoffeeScript 1.6.3
(function() {
  var Drone, _,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  _ = require('underscore');

  Drone = (function() {
    var alt, state;

    state = 'landed';

    alt = 0;

    function Drone(eventemitter, client) {
      this.eventemitter = eventemitter;
      this.client = client;
      this.updateState = __bind(this.updateState, this);
      this.client.on('navdata', function(data) {
        alt = data.demo.altitude;
        return console.log('alt', alt);
      });
    }

    Drone.prototype.start = function() {
      this.registerTakeoffAndLanding();
      return this.registerMoves();
    };

    Drone.prototype.registerTakeoffAndLanding = function() {
      var _this = this;
      this.eventemitter.on('takeoff', function() {
        return _this.client.takeoff(function() {
          return updateState('inflight');
        });
      });
      return this.eventemitter.on('land', function() {
        updateState('landing');
        return _this.client.land(function() {
          return updateState('landed');
        });
      });
    };

    Drone.prototype.registerMoves = function() {
      var _this = this;
      this.eventemitter.on('left', function(speed) {
        return sendCommand('left', speed);
      });
      this.eventemitter.on('right', function(speed) {
        return sendCommand('right', speed);
      });
      this.eventemitter.on('forward', function(speed) {
        return sendCommand('front', speed);
      });
      this.eventemitter.on('backward', function(speed) {
        return sendCommand('back', speed);
      });
      return this.eventemitter.on('altitude', function(alt) {});
    };

    Drone.prototype.sendCommand = function(cmd, arg) {
      if (state !== 'inflight') {
        return;
      }
      return this.client[cmd](arg);
    };

    Drone.prototype.updateState = function(new_state) {
      state = new_state;
      return this.eventemitter.emit(state);
    };

    return Drone;

  })();

  module.exports = Drone;

}).call(this);
